<head>
  <title>Collective Focus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">

  <!-- Latest compiled and minified JavaScript -->
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>

  <script src="/raphael-min.js"></script>

  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
</head>

<body>
  {{> header}}
  <div class="container">
  {{renderPage}}
  </div>
  {{> footer}}
</body>

<template name="header">
  <header class="navbar navbar-default navbar-fixed-top navbar-inverse" role="navigation">
    <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><i class="fa fa-circle {{status}}"></i> Collective Focus</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Link</a></li>
        <li><a href="#">Link</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
            <li class="divider"></li>
            <li><a href="#">One more separated link</a></li>
          </ul>
        </li>
      </ul>
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Link</a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown <b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li class="divider"></li>
            <li><a href="#">Separated link</a></li>
          </ul>
        </li>
      </ul>
    </div><!-- /.navbar-collapse -->
    </div>
  </header>
</template>

<template name="footer">
  <footer></footer>
</template>

<template name="home">
  <div class="page-header">
    <h1>Collective Focus <small>People doing stuff at the same time. Oh yeah.</small></h1>
  </div>
  <a id="add-team" title="Add a new team"><i class="fa fa-plus"></i></a>
  {{#each team}}
  <div class="team">
    {{> team_summary}}
  </div>
  {{/each}}
</template>

<template name="team_summary">
  <div class="timer" data-completion="{{completion}}"></div>
  <h3>{{name}}</h3>
  {{#each first_members}}
  <div class="member">
    <img src="{{avatar}}" />
    <span class="username">{{username}}</span> is
    <span class="action">{{current_action}}</span>
  </div>
  {{/each}}
  {{#if remaining_members_count}}
  <div class="etc">... et {{member_count}} autres</div>
  {{/if}}
  <a href="/team/{{_id}}">join this focus group</a>
</template>

<template name="team">
  {{#if current_team}}
  <h2>{{current_team.name}}</h2>
  <div class="jumbotron">
    {{#if current_focus}}

    <div class="timer" data-completion="{{completion}}">{{completion}}</div>
    {{#if is_current_focus_running}}

    {{#if current_task}}
    <h3>You are focusing on <strong>{{current_task.label}}</strong></h3>
    {{else}}
    <h3>You are not focusing</h3>
    {{/if}}

    {{else}}

    {{#if is_current_focus_finished}}

    {{#if current_task}}
    <h3>Done! How was your focus on <strong>{{current_task.label}}</strong>?</h3>
    <div class="col-lg-6">
      <button class="btn btn-default focus-value" type="button" data-task="{{current_task._id}}" value="0">0</button>
      <button class="btn btn-default focus-value" type="button" data-task="{{current_task._id}}" value="33">1</button>
      <button class="btn btn-default focus-value" type="button" data-task="{{current_task._id}}" value="67">2</button>
      <button class="btn btn-default focus-value" type="button" data-task="{{current_task._id}}" value="100">3</button>
    </div><!-- /.col-lg-6 -->
    {{else}}
    Waiting everyone to rate his focus.
    {{/if}}

    {{else}}  {{!-- is_finished --}}

    {{#if Meteor.userId}}

    <h3>What will you focus on?</h3>
    <div class="col-lg-6">
      <div class="input-group">
        <form id="next-focus" data-focus="{{current_focus._id}}">
          <input type="text" class="form-control" name="task" value="{{current_task.label}}">
          <span class="input-group-btn">
            <button type="submit" id="focus-define" class="btn btn-default">Go!</button>
          </span>
        </form>
      </div><!-- /input-group -->
    </div><!-- /.col-lg-6 -->
    {{#if current_task}}
    The focus will begin shortly. You can update your task until the beggining of the focus.
    {{else}} {{!-- current_task --}}
    The focus will begin shortly. Choose a task.
    {{/if}}
    {{else}} {{!-- user --}}
    Pas connect√©: login !
    {{/if}}  {{!-- user --}}

    {{/if}}  {{!-- is_finished --}}

    {{/if}}  {{!-- current_task --}}

    {{else}} {{!-- current_focus --}}

    <h3>No focus right now.</h3>
    <button id="focus-start" class="btn btn-default">Start a new one</button>

    <h3>Stats</h3>
    <div class="stats-chart"></div>

    {{/if}}  {{!-- current_focus --}}
  </div>
  {{#each all_members}}
  <div class="member" data-focus="{{focus}}">
    <img src="{{avatar}}" />
  </div>
  {{/each}}

  {{else}} {{!-- team --}}
  404
  {{/if}}

</template>
